<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<body>

          
<div metal:fill-slot="main" i18n:domain="osha">
         
    <h1 class="documentFirstHeading" i18n:domain="osha" i18n:translate="heading_index_by_nace">
      Index by NACE
    </h1>
    
    <p><a href="" 
        tal:attributes="href here/absolute_url" 
        i18n:translate="feature_back_to_mainpage">Back to <span i18n:name="title" tal:content="here/Title" /> main page</a></p>


<div tal:define="nace python:request.get('nace') or '';
                 alphabetical python:request.get('alphabetical') or '';
                 nace_name request/nace_name|string:;
                 parent python:here.aq_parent;
                 Category request/Category|python:[];
                 view context/@@nace_view;
                 utils context/@@vocabulary_helpers;
                 vocabResults python:utils.getUIDsByTerms(termList=Category, vocabularyName='Category');
                 cat_uids vocabResults/cat_uids;
                 cat_str vocabResults/cat_str;
                 ">

  <metal:block tal:condition="nace"> 

   <h2><span tal:content="nace_name"/></h2>

        <metal:block define-macro="listing">
      
          <tal:results
               define="results python:view.resultsByNACE(nace=nace, cat_uids=cat_uids);
               b_start python:request.get('b_start', 0);
               Batch python:modules['Products.CMFPlone'].Batch;
               batchsize here/getList_batchsize|site_properties/default_batchsize|python:40;
               batch python:Batch(results, int(batchsize), int(b_start), orphan=0);"
                tal:condition="results">   

        <p><a href="" tal:attributes="href string:${template/getId}?alphabetical=${alphabetical}&$cat_str"
        i18n:domain="osha" i18n:translate="link_back_to_nace">Back to NACE overview</a></p>
                
            <dl>
            <metal:block tal:repeat="res batch">
                <dt tal:define="cc res/getOSHA_COUNTRY|string:;
                    url res/getURL"><a 
                href="" tal:attributes="href url"><img src="" 
                    tal:attributes="src res/getIcon" alt="res/portal_type" i18n:attributes="alt"/> <span
                tal:replace="res/Title" /></a> 
                    </dt>
                <dd>
                <p tal:define="descr res/Description|nothing;
                   ext_url res/getExternal_url|nothing;
                   provider res/getProvider|nothing"
                   tal:condition="python: descr or ext_url">
                   <span tal:replace="structure descr" />
                   <tal:block condition="provider">
                        <br /><span class="bold" i18n:translate="label_information_provider">Information Provider</span>:
                        <span tal:replace="provider" />
                   </tal:block>     
                   <tal:block condition="ext_url">
                       <br/><span class="bold" i18n:translate="">Read more:</span> <a 
                       class="link-leave" href="" tal:attributes="href ext_url" tal:content="ext_url" />
                   </tal:block>
                </p>
                
                <p tal:define="res_lang res/getOsh_language|nothing;
                   res_format res/getOsh_format|nothing"
                   tal:condition="python:res_lang or res_format">
                   <tal:block condition="res_lang"><span i18n:translate="">Language</span>: <span tal:replace="python: ', '.join(res_lang)" /></tal:block><br/>
                   <tal:block condition="res_format"><span i18n:translate="">Format</span>: <span tal:replace="res_format" /></tal:block>
                </p>
                </dd>
                
            </metal:block>
            </dl>
          </tal:results>
       </metal:block>
    </metal:block>


    <metal:block tal:condition="not:nace">
         <span tal:condition="not:alphabetical">
            <p i18n:translate="info_index_nace_bynace">The information provided here is sorted by NACE number.<br /> 
            You can also <span><a tal:attributes="href string:${template/getId}?alphabetical=1&$cat_str">sort the links alphabetically</a></span>.</p>  
          </span>
          
          <span tal:condition="alphabetical">
            <p i18n:translate="info_index_nace_atoz">The information provided here is sorted alphabetically.<br /> 
            You can also <span><a tal:attributes="href string:${template/getId}?$cat_str">
            sort the links by NACE code</a></span>.</p>  
          </span>
          
            <span tal:define="nacelist python:view.resultsOverview(cat_uids=cat_uids, alphabetical=alphabetical);
                    global havenace python:0">
          
                    <span tal:repeat="ni nacelist">
                        <span tal:define="global havenace python:1"/>
                        <a href="" tal:attributes="href string:${template/getId}?nace=${ni/id}&alphabetical=${alphabetical}&nace_name=${ni/id} - ${ni/Title}&$cat_str">
                       <span tal:content="ni/Title"/></a> (<span tal:content="ni/counter"/>)<br/>
                    </span>          
                <span tal:condition="not:havenace">No NACE information available</span>
           </span>
        </metal:block>

    </div>
  </div>

</body>
</html>