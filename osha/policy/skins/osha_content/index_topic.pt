<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<body>

          
<div metal:fill-slot="main" i18n:domain="osha">

<h1 class="documentFirstHeading" i18n:domain="osha" i18n:translate="heading_index_by_topic">
  Index by Topic
  <a name="top"></a>
</h1>


<p><a href="" 
    tal:attributes="href here/absolute_url" 
    i18n:translate="feature_back_to_mainpage">Back to <span i18n:name="title" tal:content="here/Title" /> main page</a></p>

 

<div tal:define="country request/country|string:;
                 country_name request/country_name|string:;
                 site_pos python:here.portal_url(1) + '/' + here.portal_url.getRelativeContentURL(here);
                 site_pos_path python:test(site_pos.startswith('/'), site_pos[1:], site_pos);
                 parent python:here.aq_parent;
                 view context/@@topic_view;
                 Category request/Category|python:[];
                 cat_title request/cat_title|string:
                 view context/@@topic_view;
                 utils context/@@vocabulary_helpers;
                 vocabResults python:utils.getUIDsByTerms(termList=Category, vocabularyName='Categories');
                 cat_uids vocabResults/cat_uids|python:[];
                 cat_str vocabResults/cat_str|python:[];
                 cat_uid request/cat_uid|python:len(cat_uids) and cat_uids[0] or '';
                 R request/R|string:;
                 country python:1;
                  ">
                 
<metal:block tal:condition="R" >
  <span >
       
 <p><a href="" tal:attributes="href string:${parent/absolute_url}/${here/getId}/${template/getId}?Category=$Category"
        i18n:domain="osha" i18n:translate="link_back_to_topics">Back to Topics overview</a></p>   
        
        
 <p tal:condition="country"><a href="" tal:attributes="href string:${parent/absolute_url}/${here/getId}/${template/getId}?cat_uid=${cat_uid}"><span i18n:domain="osha" i18n:translate="Back to">Back to</span>
    &quot;<span tal:content="cat_title" />&quot;</a></p>
                   

  <metal:block tal:condition="not:country">
      <!--span tal:define="country_map python:here.getTopics(site_pos_path, country_count=1);
                 mdtool nocall:here/portal_metadata;
                 mdcoll  nocall:mdtool/collection;
                 mds python:getattr(mdcoll, 'osha_metadata');
                 mde python:getattr(mds, 'Country', '');
                 mis python:mde.getMenueitems(); 
              "-->
              <span>

    <h2><span i18n:domain="osha" i18n:translate="" tal:content="cat_title">Topic</span></h2>      

    <p i18n:translate="info_index_topic">The information provided here is broken down by country of origin. We have tried to keep these topics clear and simple.
    </p>
  
    
    <span tal:repeat="mi mis">
    <h3><a href="" tal:attributes="href string:${template/getId}?cat_uid=${cat_uid}&country=${mi/getId}&country_name=${mi/Title}"><span tal:content="mi/Title"/></a></h3>
        <span tal:define="smis python:mi.getMenueitems;
            global result_countrygroup python:0;">
          <span tal:repeat="smi smis">
             <span tal:define="country_id string:/${mi/getId}/${smi/getId};
                   num_res python:country_map.get(country_id,'')"
                   tal:condition="num_res">
                   <span tal:define="global result_countrygroup python:1"/>  
               <a href="" tal:attributes="href string:${template/getId}?cat_uid=${cat_uid}&country=${mi/getId}/${smi/getId}&country_name=${smi/Title}"><span i18n:domain="osha" i18n:translate="" tal:content="smi/Title">Country</span></a> (<span tal:content="num_res" />) <br /> 
             </span>
         </span>
          <div tal:condition="python:result_countrygroup==0"><span i18n:domain="osha" i18n:translate="description_no_results_found">No results were found.</span></div>
        </span>
        <br />
      </span>
    </span>
   </metal:block>
   
   
   
   <metal:block tal:condition="country">
        <h2><span i18n:domain="osha" i18n:translate="" tal:content="cat_title">Topic</span> - <span i18n:domain="osha" i18n:translate="" tal:content="country_name" >Country</span></h2>

        <!-- python:here.getTopics(site_pos_path, country=country) -->
              <tal:results define="results python:view.getResultsByCategory(cat_uid)">
                 <span tal:define="b_start python:request.get('b_start', 0);
                               Batch python:modules['Products.CMFPlone'].Batch;
                               batchsize here/getList_batchsize|site_properties/default_batchsize|python:40;
                               batch python:Batch(results, int(batchsize), int(b_start), orphan=0)"
                    tal:condition="results">
                <!--div metal:use-macro="here/list_batch_macros/macros/navigation" /-->
                <span tal:define="global result_countrygroup python:1"/>
                <dl tal:repeat="res batch">
                  <dt><a href="#" tal:attributes="href res/getURL"><img src="" 
                    tal:attributes="src res/getIcon" alt="res/portal_type" i18n:attributes="alt"/><span tal:content="res/Title"/></a> ( <span i18n:domain="osha" i18n:translate="" tal:content="res/getOSHA_Country">Country</span> )
                  </dt>
                  <dd>
                    <p tal:define="descr res/Description|nothing;
                       ext_url res/getExternal_url|nothing;
                       provider res/getProvider|nothing"
                       tal:condition="python: descr or ext_url">
                       <span tal:replace="structure descr" />
                       <tal:block condition="provider">
                            <br /><span class="bold" i18n:translate="label_information_provider">Information Provider</span>:
                            <span tal:replace="provider" />
                       </tal:block>                       
                       <tal:block condition="ext_url">
                           <br/><span class="bold" i18n:translate="">Read more:</span> <a 
                           class="link-leave" href="" tal:attributes="href ext_url" tal:content="ext_url" />
                       </tal:block>
                    </p>
                    
                    <p tal:define="res_lang res/getOsh_language|nothing;
                       res_format res/getOsh_format|nothing"
                       tal:condition="python:res_lang or res_format">
                       <tal:block condition="res_lang"><span i18n:translate="">Language</span>: <span tal:replace="python:', '.join(res_lang)" /></tal:block><br/>
                       <tal:block condition="res_format"><span i18n:translate="">Format</span>: <span tal:replace="res_format" /><br /></tal:block>
                    </p>
                  </dd>
                <span tal:condition="repeat/res/end"><a href="#" tal:attributes="href string:${template/getId}?${request/QUERY_STRING}#top"><span i18n:domain="osha" i18n:translate="link_page_top">Top of the page</span></a></span>
                </dl>
                <!--div metal:use-macro="here/list_batch_macros/macros/navigation_bottom" /-->
               </span>
              
            <div tal:condition="not:results"><span i18n:domain="osha" i18n:translate="description_no_results_found">No results were found.</span></div>
         </tal:results>

    
      </metal:block>
    </span> 
  </metal:block>
       
     <!-- python:here.getTopics(site_pos_path)-->
   <metal:block tal:condition="python:not R and cat_uid">
        <ul tal:define="toplist python:view.resultsOverview(here, cat_uid)" class="topiclist">

            <tal:block repeat="topic toplist">
            <li tal:define="line topic/separation_line|string:" tal:attributes="class python:test(line, 'separated', 'plain')">
                <a href="#" tal:attributes="href string:${template/getId}?cat_uid=${topic/cat_uid}&R=1&cat_title=${topic/Title}&Category=$Category"><span tal:content="topic/Title"/>  (<span tal:content="topic/counter"/>)</a>
            </li>
            </tal:block>
       </ul>
    </metal:block>
    <metal:block tal:condition="python:not R and not cat_uid">
        <p>No results found.</p>
    </metal:block>

   </div>

 </div>

</body>
</html>
