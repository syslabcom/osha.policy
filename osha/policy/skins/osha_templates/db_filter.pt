<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="osha"> 

<!--metal:block fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border',1)" /-->

<metal:cssslot fill-slot="css_slot"
               tal:define="global mockup here/@@ATMockup;
                           dummy python:mockup.preload(types=[('RiskAssessmentLink', 'RiskAssessmentLink')]);">
  <style type="text/css" media="all" tal:condition="exists: portal/riskassessment_styles.css"
         tal:content="string:@import url($portal_url/riskassessment_styles.css);">
  </style>
  <style type="text/css">
    .column1 { float: left; width: 35%; padding-right: 10px; }
    .column2 { float: right; width: 55%; padding-left: 10px; border-left: 1px dotted gray; }
    
    .column2 .field_default, 
    .column2 .field_nace { width: 300px; padding: 2px 0; }
    .column2 .field_default input, 
    .column2 .field_default select { width: 300px; }
    .column2 .field_nace #quicksearch_nace { width: 200px; }
    .column2 .field_nace .searchButton { width: 80px; }
    
    #db_results dd { background-color: transparent; margin-left: 0; padding-left: 2em !important; border-bottom: 1px dotted gray; padding: 2px; } 
    
</style>
</metal:cssslot>

<metal:javascriptslot fill-slot="javascript_head_slot">
  <tal:js define="js python:here.getUniqueWidgetAttr(mockup.getFields(), 'helper_js')"
          condition="js"
          repeat="item js">
    <script type="text/javascript"
            charset="iso-8859-1"
            tal:condition="python:exists('portal/%s' % item)"
            tal:attributes="src string:$portal_url/$item">
    </script>
  </tal:js>
</metal:javascriptslot>

<div metal:fill-slot="main" i18n:domain="osha"
       tal:define="local_keyword python:here.getProperty('keyword', '');
                   keywords request/keywords| local_keyword |string:;
                   subcategory request/subcategory | string:;
                   SearchableText request/SearchableText|string:;
                   nace request/nace|string:;
                   nace python:test(nace==[''], '', nace);
                   category request/category|string:;
                   getTargetLanguage request/getTargetLanguage|string:;
                   getCountry request/getCountry|string:;
                   Batch python:modules['Products.CMFPlone'].Batch;
                   DateTime python:modules['DateTime'].DateTime;
                   b_size python:10;b_start python:0;
                   b_start request/b_start | b_start;
                   desc_length site_properties/search_results_description_length;
                   desc_ellipsis site_properties/ellipsis;
                   searchterm request/SearchableText|nothing;
                   index python: test('index' in here.objectIds(), getattr(here,'index', None), here)
                   ">

    <div class="figure-box">
        <div class="figure">
            <img tal:define="keyword python:here.getProperty('keyword');
                             timg_path string:theme_image_${keyword}.gif;
                             timg python:getattr(portal, timg_path,
                                    getattr(portal, 'dummyimage80.gif'))"
                 tal:condition="python:timg is not None" 
                 tal:replace="structure timg/tag" />
        </div>
    </div>
         
         
    <h1>
        <img tal:define="search_img python:getattr(portal, 'database_search.gif')"
             tal:replace="structure search_img/tag" />
        <span tal:condition="local_keyword">
            <span tal:omit-tag="" i18n:translate="label_search_database_on">Search the Link Database on</span> 
            <span tal:replace="index/Title" />
        </span>
        <span tal:condition="not:local_keyword">
            <span tal:omit-tag="" i18n:translate="label_search_database">Search the Link Database</span>
        </span>
    </h1>
    
    
    <span tal:condition="local_keyword">
        <p i18n:translate="help_database_filter_topic" i18n:domain="osha">
            On this page you can search through all links related to this topic. The filter results will display directly under the filter form. If you select some filter criteria the list will get more precise. 
        </p>
    </span>
    <span tal:condition="not:local_keyword">
        <p i18n:translate="help_database_filter" i18n:domain="osha">
            On this page you can search through all links available in the site. The filter results will display directly under the filter form. If you select some filter criteria the list will get more precise. 
        </p>
    </span>
   
    <br />
    <a tal:attributes="href here/absolute_url" class="link-parent">
        Back to <span tal:replace="index/Title" />
    </a>

    
    <h2 i18n:translate="label_search_osh_links">Search OSH Links:</h2>
            
    
    <form tal:attributes="action template/id" method="get">
      
      <div id="searchfields">
      
         <div class="column1">
            <metal:use use-macro="here/filter_macros/macros/SearchableText_compact"></metal:use>
            <div class="columnBottom field">
             <div class="formHelp">
                Filter your search by selecting one or more of the filters.
                You can always remove any filter again by selecting the empty entry or by clicking the Reset button.
             </div>

            </div>
          </div>
          
          <div class="column2">
            <!--div class="columnTop field">
              <label i18n:translate="label_search_filters">Filters</label>
            </div-->

            <div class="field_default">
               <metal:use use-macro="here/filter_macros/macros/TargetLanguage_compact"></metal:use>
            </div> 
            <div class="field_default">
              <metal:use use-macro="here/filter_macros/macros/Country_compact_index"></metal:use>
            </div>
            <div class="field_default"
                 tal:define="root_node   local_keyword | string:;
                                    vocabulary  string:Subcategory;
                                    value       subcategory;
                                    fieldName   string:subcategory;">
                <label i18n:translate="label_subcategory" >Subcategory</label><br>

                <metal:use use-macro="here/filter_macros/macros/ATVocabularyDropdown"></metal:use>
            </div>
            <div class="field_nace"
                 tal:define="level python:2;
                             portal_type string:OSH_Link">
                          <metal:use use-macro="here/filter_macros/macros/NACE"></metal:use>
            </div> 
               
          </div>
          
         

        </div>
       


        <br clear="all">
        
        
        <div class="formControls">
          <input class="context"
                   type="submit"
                   name="submit"
                   value="Search"
                   i18n:domain="plone"
                   i18n:attributes="value label_search;"
                   />
          <input  class="context" type="reset" value="Reset" 
                tal:attributes="onclick string:window.location='${here/absolute_url}/${template/getId}'" />
        
        </div>
    </form>
    
    <br clear="all"><br>

     <div tal:define="query python:{'portal_type': ['OSH_Link'],
                                       'Subject':keywords,
                                       'nace':nace,
                                       'getTargetLanguage':getTargetLanguage,
                                       'subcategory':subcategory,
                                       'getCountry':getCountry,
                                       'SearchableText':SearchableText,
                                       'sort_on': 'modified',
                                       'sort_order':'desc'};
                         res python:here.portal_catalog(query);
                         results res;
                        ">
      <!--  query: <span tal:replace="query" /> -->
        <!--h1>Filtered by:
            <span tal:condition="python:keywords"><span tal:replace="keywords"/></span>
        </h1-->
        
     <h2>
        <span i18n:translate="heading_search_results">
            Search results
        </span>
        <span class="discreet">
        &mdash;
        <span i18n:translate="batch_x_items_matching_your_criteria"
        ><span i18n:name="number" 
        tal:omit-tag="" 
        tal:content="python:len(results)">234</span> items matching your search terms</span>
    </h2>

    <div tal:condition="not: results">
        <p><strong i18n:translate="description_no_results_found">No results were found.</strong></p>
    </div>


    <div tal:condition="results"
         tal:define="batch python:Batch(results, b_size, int(b_start), orphan=1);">
        
        
        <dl id="db_results">
        <tal:results repeat="result batch">
        <tal:entry define="result_url result/getURL;
                           url string:$result_url/view?searchterm=${searchterm};
                           title result/Title|string:;
                           item_modified result/modified;
                           item_pubdate result/effective;
                           item_creator result/Creator;
                           ">
            <dt>
                <a href="#" tal:attributes="href url" >
                    <img tal:attributes="src string:${result/getIcon};
                                     alt string:Link icon" />
                    <span tal:replace="title" />
                </a>
            </dt>
                 
            <dd>                              
                <span tal:define="descr result/Description" tal:content="structure descr" />
                  <br/>
                <span class="documentByLine">
                    <tal:modified>
                        &mdash;
                        <tal:mod i18n:translate="box_item_published">
                          publication date
                        </tal:mod>
                        <span tal:replace="python:toLocalizedTime(item_pubdate, long_format=0)"
                            tal:on-error="python:toLocalizedTime('2000/01/01', long_format=0)">
                          August 16, 2001 at 23:35:59
                        </span>
                    </tal:modified>                    
                    <!--tal:name tal:condition="item_creator"
                              tal:define="author python:mtool.getMemberInfo(item_creator)">
                          <span i18n:translate="label_by_author">
                            by
                          <a href="#"
                             tal:attributes="href string:${portal_url}/author/${item_creator}"
                             tal:content="python:author and author['fullname'] or item_creator"
                             tal:omit-tag="not:author"
                             i18n:name="author">
                            Bob Dobalina
                          </a>
                          </span>
                    </tal:name-->
                </span>
            </dd>
            
        </tal:entry>
        </tal:results>
        </dl>
        
        <div metal:use-macro="here/batch_macros/macros/navigation" />


    </div>
  </div>


</div>

<metal:sub fill-slot="sub" /> 


</html>

  