<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<metal:block fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border',1)" />

<metal:cssslot fill-slot="css_slot"
               tal:define="global mockup here/@@ATMockup;
                           dummy python:mockup.preload(types=[('OSH_Link', 'OSHContentLink')]);">
  <!--style type="text/css" media="all" tal:condition="exists: portal/riskassessment_styles.css"
         tal:content="string:@import url($portal_url/riskassessment_styles.css);">
  </style-->
</metal:cssslot>

<metal:javascriptslot fill-slot="javascript_head_slot">
  <script language="JavaScript">
  function resetSize(aSelect) {
    if(aSelect) {
      aSelect.style.width = 'auto';
    }
  }
  </script>

  <tal:js define="js python:here.getUniqueWidgetAttr(mockup.getFields(), 'helper_js')"
          condition="js"
          repeat="item js">
    <script type="text/javascript"
            charset="iso-8859-1"
            tal:condition="python:exists('portal/%s' % item)"
            tal:attributes="src string:$portal_url/$item">
    </script>
  </tal:js>
</metal:javascriptslot>

<div metal:fill-slot="main" i18n:domain="elevateIT"
       tal:define="keywords request/keywords|string:;
                   SearchableText request/SearchableText|string:;
                   nace request/NACE|string:;
                   category request/category|string:;
                   language request/Language|string:;
                   country request/country|string:;
                   review_state request/review_state|string:;
                   Creator request/Creator|string:;
                   ExternalUrl request/ExternalUrl|string:;
                   Batch python:modules['Products.CMFPlone'].Batch;
                   DateTime python:modules['DateTime'].DateTime;
                   b_size python:10;b_start python:0;
                   b_start request/b_start | b_start;
                   desc_length site_properties/search_results_description_length;
                   desc_ellipsis site_properties/ellipsis;
                   searchterm request/SearchableText|nothing;
                   ">

<style type="text/css">
    #searchfields { background-color: #F3F6FF; border: 1px solid gray !important; padding:5px 10px; clear: both; overflow: hidden; }
    .column1 { float: left; width: 40%; padding-right: 10px; }
    .column2 { float: right; width: 55%; padding-left: 10px; border-left: 1px dotted gray; }
    .fieldSizer { width: 300px; overflow: hidden; } 
    .columnTop { width: 100%; padding-bottom: 10px; margin-bottom: 10px; border-bottom: 1px dotted gray; }
    .columnBottom { width: 100%; padding-top: 10px; margin-top: 30px; border-top: 1px dotted gray; }
    
    .column1 input { width: 100%; }
    .column2 input, .column2 select { width: 300px; }
    #resulttable {background-color: #C4DAFF; border: 1px solid gray !important;  margin:5px 0px; padding:0px; border-collapse: collapse; }
    #resulttable td {margin:0px; padding:5px; }
    #tableheader, #tableheader td {background-color: #F3F6FF; font-weight: bold; padding:5px}
</style>

    <h1>Worklist</h1>
    <div>
        Please use these fields to select workitems.
    </div>

    <form tal:attributes="action template/id" method="get">

      <div id="searchfields" tal:define="view here/@@vocabulary_helper">
            
        <span tal:define="size python:35"
            style="float:left">
            <metal:use use-macro="here/filter_macros/macros/SearchableText_compact"></metal:use>
        </span>
            
        <span style="float:left">
            <metal:use use-macro="here/filter_macros/macros/ReviewState_compact"></metal:use>
        </span>

        <span>
            <metal:use use-macro="here/filter_macros/macros/Author_compact"></metal:use>
        </span>

        <br style="clear:both" />

        <span tal:define="size python:35"
            style="float:left">
            <metal:use use-macro="here/filter_macros/macros/ExternalUrl_compact"></metal:use>
        </span>
        
        <span>
            <metal:use use-macro="here/filter_macros/macros/Keyword"></metal:use>
        </span>


            
            
        <br clear="all" style="clear:both">

      </div>

        <div class="formControls">
          <input class="context" type="submit" value="Search" />
        </div>
    </form>
    <br clear="all"><br>
    
    Category: <span tal:replace="category" />

  <div tal:condition="python:SearchableText or review_state or Creator or ExternalUrl or category">
    <div tal:define="category python:[x for x in category if x];
                     category python:test(len(category), category, '');
                    query python:{'portal_type': ['OSH_Link'],
                                   'review_state':review_state,
                                   'category':category,
                                   'getExternal_url': ExternalUrl,
                                   'Creator': Creator,
                                   'SearchableText':SearchableText,
                                   'sort_on': 'modified',
                                   'sort_order':'desc'};
                     res python:here.portal_catalog(query);
                     results res;
                    ">
        <strong>
            <span i18n:translate="batch_x_items_matching_your_criteria"><span i18n:name="number" tal:content="python:len(results)">234</span> items match your criteria.</span>
        </strong>

        <div tal:condition="not: results">
            <p><strong i18n:translate="description_no_results_found">No results were found.</strong></p>
        </div>


    <div tal:condition="results"
          tal:define="batch python:Batch(results, b_size, int(b_start), orphan=1);">

        <table border="0" >
        <tr id="tableheader">
          <td></td>
          <td>Title</td>
          <td>Last modified</td>
          <td>Review State</td>
        </tr>
        <tal:results repeat="result batch">
            <tal:entry define="result_url result/getURL;
                               url string:$result_url/view?searchterm=${searchterm};
                               title result/Title|string:;
                               ">
                <tr>
                  <td>
                    <img tal:attributes="src string:${result/getIcon};
                                         alt string:Link icon"
                              tal:on-error="nothing" />
                  </td>
                  <td>
                    <a href="#" tal:attributes="href url" >
                        <span tal:replace="title" />
                    </a>
                  </td>
                  <td>
                      <nobr><span tal:on-error="nothing" tal:replace="python:toLocalizedTime(result['modified'])"/></nobr>
                  </td>
                  <td>
                    <span tal:replace="result/review_state" />
                  </td>
                 </tr>
            </tal:entry>
        </tal:results>
        </table>
        <br><br>
        <div metal:use-macro="here/batch_macros/macros/navigation" />

       </div>
     </div>
    </div>
  </div>

</html>

